---
title: "Magnoliids preliminary results"
output: pdf_document
fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r table, echo=FALSE}
library(knitr)
setwd("~/Dropbox/projects/AJH_magnoliids/PAFTOL_magnoliids/")
df<-read.csv("outputs/exon_stats.csv",row.names = 1, header=F)

colnames(df)<-c("25% inds", "50% inds", "75% inds", "90% inds")
df<-df[c(2:length(df[,1])),]

kable(df,caption = "number of exons recovered using different filtering levels. Rows represent increasing percentage of exon length covered, columns represent increasing percentage of individuals exons were recovered in. For example cell 1,1 shows the number exons in which we recovered at least 25% of the exon length in at least 25% of the individuals in the dataset.")

```


```{r venn,echo=FALSE,message=F,warning=F,results='hide',fig.width=6,fig.height=6,fig.cap="Venn diagram showing overlap of 75/50 exons in each order included in the analysis. Individuals were split by order into different datasets. Filtering was then done independently on each of the five datasets. Overlap among exons was then calculated. For example,  there are 24 exons that are common to Laurales and Magnoliales, but not recovered in the other orders after 75/50 filtering."}

setwd("~/Dropbox/projects/AJH_magnoliids/PAFTOL_magnoliids/")

library(ape)

#Calculate sizes for gene and sample labels, increase the multiplier to make text bigger
gene.size.multiplier = .1
sample.size.multiplier = .5

sample.filename = "data/test_seq_lengths.txt"
sample.data= as.matrix(read.table(sample.filename,header=T,row.names=1,sep="\t"))

#length reference exon
reference.len = as.numeric(sample.data[1,])

#families
canel<-read.table("data/canel.txt")
canel<-as.character(canel$V1)

chlor<-read.table("data/chlor.txt")
chlor<-as.character(chlor$V1)

laura<-read.table("data/laura.txt")
laura<-as.character(laura$V1)

magno<-read.table("data/magno.txt")
magno<-as.character(magno$V1)

piper<-read.table("data/piper.txt")
piper<-as.character(piper$V1)

c(canel,chlor,laura,magno,piper)

ord_l<-list(canel,chlor,laura,magno,piper,c(canel,chlor,laura,magno,piper))

l_75_75<-list()

for(i in 1:6){

#extract only sample exon lengths
sample.len = sample.data[rownames(sample.data) %in% ord_l[[i]],]

#calculate percentage of exon recovered for each exon in each individual
percent.len= sweep(sample.len, 2, reference.len, "/")
percent.len = ifelse(percent.len>1,1,percent.len)
percent.len.limit <- percent.len

# if percentage exon length recovered is >= 75% make value 1
# if not make value 0
percent.len.limit[percent.len.limit>=0.5] = 1
percent.len.limit[percent.len.limit<0.5] = 0

#For each exon calculate number of individuals with >= 75% of exon
col <- colSums(percent.len.limit != 0)

#Calculate % individuals with >= 75% of exon for each exon
col <- col / (length(sample.len[,1]))

#Extract only 75_75 exons from original dataset
length7575<-sample.data[,col>=0.50]

#Get a list of names of 75_75 exons
l_75_75[[i]]<-names(length7575[1,])

}

library(gplots)
par(mar=c(0,0,0,0))

venn(list(Canellales=l_75_75[[1]],
          Chloranthales=l_75_75[[2]],
          Laurales=l_75_75[[3]],
          Magnoliales=l_75_75[[4]],
          Piperales=l_75_75[[5]]), small =T)

```

